<html>
<title>Alexa Schnittstelle f√ºr Temperatur</title>
<head>
   <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
   <script src="https://assets.shiftr.io/js/mqtt-latest.js"></script>
   <!--<script src="mqtt.js" charset="utf-8"></script>-->
</head>
 <body>
   <p id="data"></p>
   <script>
        
    var client = mqtt.connect('wss://7ab8d043:4acf899e28d7740c@broker.shiftr.io:443', { //Wichtig wss! Sonst keine sichere Verbindung im Browser
      clientId: 'Alexa-Temperatur'
    });
 
    client.on('connect', function(){
      console.log('client has connected!');

      client.subscribe('/smartGreenhouse/Temperature');
    });
    
    setInterval(function(){
       client.publish('/smartGreenhouse/Temperature', '24');
    }, 1000);  
      
    client.on('message', function(topic, message) {
      console.log('new message:', topic, message.toString());
      //var tempText = '{"value":["' + message.toString() + '"]}';
       var tempText = 24;
      $('#data').text(tempText);
    });
      
      
      
    //handle a user request
function onRequest(request, response){
    if(request.method =='GET' && request.url=='/'){
        response.writeHead(200, {"Content-Type":"Temperatur.html"});
        fs.createReadStream("./index.html").pipe(response);
        console.log(request.url);
    }
    else if(request.method =='GET' && request.url=='/try'){
     console.log("I am getting the request");
     response.writeHead(200, {"Content-Type":"text/plain","Access-Control-Allow Origin":"*"});

        response.write("test message");
        response.end();
    }
    else{
        console.log(request.url);
        send404Response(response);
    }

}

http.createServer(onRequest).listen(8888);
    
    
   </script>
 </body>
</html>
